var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Myna;(function(Myna_1){function _initialize(text){_input=text;_childNodes=[]}function match(r,s){_initialize(s);return r.match(0)}Myna_1.match=match;function parse(r,s){_initialize(s);var curNode=new AstNode(r.ast);curNode.children=_childNodes;curNode.end=r.parse(0);_childNodes=[];return curNode}Myna_1.parse=parse;function tokenize(r,s){return parse(r.ast.zeroOrMore,s).children}Myna_1.tokenize=tokenize;(function(Exceptions){Exceptions[Exceptions["MissingOverride"]=0]="MissingOverride";Exceptions[Exceptions["InternalStackError"]=1]="InternalStackError";Exceptions[Exceptions["InfiniteLoop"]=2]="InfiniteLoop";Exceptions[Exceptions["InvalidRuleType"]=3]="InvalidRuleType";Exceptions[Exceptions["CloneInvalidType"]=4]="CloneInvalidType";Exceptions[Exceptions["RangeRequiresChars"]=5]="RangeRequiresChars";Exceptions[Exceptions["TokenIncludedTwiceInLookup"]=6]="TokenIncludedTwiceInLookup"})(Myna_1.Exceptions||(Myna_1.Exceptions={}));var Exceptions=Myna_1.Exceptions;Myna_1.grammars={};Myna_1.allRules={};var _nextId=0;function genId(){return _nextId++}var failed=-1;var _input="";var _childNodes;function RuleTypeToRule(rule){if(rule instanceof Rule)return rule;if(typeof rule==="string")return text(rule);if(typeof rule==="boolean")return rule?Myna_1.truePredicate:Myna_1.falsePredicate;throw Exceptions.InvalidRuleType}Myna_1.RuleTypeToRule=RuleTypeToRule;var AstNode=function(){function AstNode(rule,start,end){if(start===void 0){start=0}if(end===void 0){end=failed}this.rule=rule;this.start=start;this.end=end;this.children=null}Object.defineProperty(AstNode.prototype,"name",{get:function(){return this.rule!=null?this.rule.name:"unnamed"},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"fullName",{get:function(){return this.rule!=null?this.rule.fullName:"unnamed"},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"allText",{get:function(){return _input.slice(this.start,this.end)},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"isLeaf",{get:function(){return this.children==null||this.children.length==0},enumerable:true,configurable:true});AstNode.prototype.child=function(name){if(this.children)for(var _i=0,_a=this.children;_i<_a.length;_i++){var c=_a[_i];if(c.name==name)return c}return null};Object.defineProperty(AstNode.prototype,"_firstChildStart",{get:function(){return this.isLeaf?this.end:this.children[0].start},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"_lastChildEnd",{get:function(){return this.isLeaf?this.end:this.children[0].end},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"beforeChildrenText",{get:function(){return _input.slice(this.start,this._firstChildStart)},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"afterChildrenText",{get:function(){return _input.slice(this._lastChildEnd,this.end)},enumerable:true,configurable:true});Object.defineProperty(AstNode.prototype,"allChildrenText",{get:function(){return _input.slice(this._firstChildStart,this._lastChildEnd)},enumerable:true,configurable:true});return AstNode}();Myna_1.AstNode=AstNode;var Rule=function(){function Rule(rules){this.rules=rules;this.name="";this.grammarName="";this.id=genId();this.type="";this._createAstNode=false}Rule.prototype.parseImplementation=function(index){throw Exceptions.MissingOverride};Rule.prototype.match=function(index){if(index<0||index>_input.length)return false;return this.parseImplementation(index)!=failed};Rule.prototype.parse=function(index){if(index<0||index>_input.length)return failed;if(!this._createAstNode){return this.parseImplementation(index)}else{var oldAst=_childNodes;var node=new AstNode(this,index);_childNodes=[];var end_1=this.parseImplementation(index);if(end_1===failed){_childNodes=oldAst;return failed}node.children=_childNodes;_childNodes=oldAst;_childNodes.push(node);node.end=end_1;return end_1}};Rule.prototype.setType=function(typeName){this.type=typeName;return this};Rule.prototype.setName=function(grammarName,ruleName){this.grammarName=grammarName;this.name=ruleName;return this};Object.defineProperty(Rule.prototype,"definition",{get:function(){return this.type+"("+this.rules.map(function(r){return r.toString()}).join(", ")+")"},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"fullName",{get:function(){return this.grammarName+"."+this.name},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"nameOrDefinition",{get:function(){return this.name?this.fullName:this.definition},enumerable:true,configurable:true});Rule.prototype.toString=function(){return this.nameOrDefinition};Object.defineProperty(Rule.prototype,"firstChild",{get:function(){return this.rules[0]},enumerable:true,configurable:true});Rule.prototype.cloneImplementation=function(){throw Exceptions.MissingOverride};Object.defineProperty(Rule.prototype,"copy",{get:function(){var r=this.cloneImplementation();if(typeof r!==typeof this)throw Exceptions.CloneInvalidType;r.name=this.name;r.grammarName=this.grammarName;r.type=this.type;r._createAstNode=this._createAstNode;return r},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"ast",{get:function(){var r=this.copy;r._createAstNode=true;return r},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"hasAstChildRule",{get:function(){return this.rules.filter(function(r){return r.isAstRule}).length>0},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"isAstRule",{get:function(){return this._createAstNode||this.hasAstChildRule&&(this instanceof Sequence||this instanceof Choice||this instanceof Bounded)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"astRuleDefn",{get:function(){var rules=this.rules.filter(function(r){return r.isAstRule});if(!rules.length)return this.name;if(rules.length==1){var result=rules[0].astRuleNameOrDefn;if(this instanceof Bounded)result+="["+this.min+","+this.max+"]";return result}if(this instanceof Sequence)return"seq("+rules.map(function(r){return r.astRuleNameOrDefn}).join(",")+")";if(this instanceof Choice)return"choice("+rules.map(function(r){return r.astRuleNameOrDefn}).join(",")+")";throw"Internal error: not a valid AST rule"},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"astRuleNameOrDefn",{get:function(){if(this._createAstNode)return this.name;return this.astRuleDefn},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"opt",{get:function(){return opt(this)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"zeroOrMore",{get:function(){return zeroOrMore(this)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"oneOrMore",{get:function(){return oneOrMore(this)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"not",{get:function(){return not(this)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"advance",{get:function(){return this.then(Myna_1.advance)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"ws",{get:function(){return this.then(Myna_1.ws)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"all",{get:function(){return this.then(Myna_1.all)},enumerable:true,configurable:true});Object.defineProperty(Rule.prototype,"end",{get:function(){return this.then(Myna_1.end)},enumerable:true,configurable:true});Rule.prototype.then=function(r){return seq(this,r)};Rule.prototype.thenAt=function(r){return this.then(at(r))};Rule.prototype.thenNot=function(r){return this.then(not(r))};Rule.prototype.or=function(r){return choice(this,r)};Rule.prototype.until=function(r){return repeatWhileNot(this,r)};Rule.prototype.untilPast=function(r){return repeatUntilPast(this,r)};Rule.prototype.repeat=function(count){return repeat(this,count)};Rule.prototype.bounded=function(min,max){return bounded(this,min,max)};Rule.prototype.delimited=function(delimiter){return delimited(this,delimiter)};Rule.prototype.butNot=function(r){return not(r).then(this)};return Rule}();Myna_1.Rule=Rule;var Sequence=function(_super){__extends(Sequence,_super);function Sequence(rules){_super.call(this,rules);this.type="seq"}Sequence.prototype.parseImplementation=function(index){for(var _i=0,_a=this.rules;_i<_a.length;_i++){var r=_a[_i];index=r.parse(index);if(index===failed)return index}return index};Object.defineProperty(Sequence.prototype,"definition",{get:function(){var result=this.rules.map(function(r){return r.toString()}).join(" ");if(this.rules.length>1)result="("+result+")";return result},enumerable:true,configurable:true});Sequence.prototype.cloneImplementation=function(){return new Sequence(this.rules)};return Sequence}(Rule);Myna_1.Sequence=Sequence;var Choice=function(_super){__extends(Choice,_super);function Choice(rules){_super.call(this,rules);this.type="choice"}Choice.prototype.parseImplementation=function(index){var state=_childNodes.length;for(var _i=0,_a=this.rules;_i<_a.length;_i++){var r=_a[_i];var result=r.parse(index);if(result===failed){_childNodes.length=state;continue}return result}return failed};Choice.prototype.match=function(index){for(var _i=0,_a=this.rules;_i<_a.length;_i++){var r=_a[_i];if(r.match(index))return true}return false};Object.defineProperty(Choice.prototype,"definition",{get:function(){var result=this.rules.map(function(r){return r.toString()}).join(" / ");if(this.rules.length>1)result="("+result+")";return result},enumerable:true,configurable:true});Choice.prototype.cloneImplementation=function(){return new Choice(this.rules)};return Choice}(Rule);Myna_1.Choice=Choice;var Bounded=function(_super){__extends(Bounded,_super);function Bounded(rule,min,max){if(min===void 0){min=0}if(max===void 0){max=Infinity}_super.call(this,[rule]);this.min=min;this.max=max;this.type="bounded"}Bounded.prototype.parseImplementation=function(index){var result=index;for(var i=0;i<this.max;++i){var tmp=this.firstChild.parse(result);if(tmp===failed)return i>=this.min?result:failed;if(this.max<0)if(result===tmp)throw Exceptions.MissingOverride;if(i>_input.length)return failed;result=tmp}return result};Object.defineProperty(Bounded.prototype,"definition",{get:function(){if(this.min==0&&this.max==1)return this.firstChild.toString()+"?";if(this.min==0&&this.max==Infinity)return this.firstChild.toString()+"*";if(this.min==1&&this.max==Infinity)return this.firstChild.toString()+"+";return this.firstChild.toString()+"{"+this.min+","+this.max+"}"},enumerable:true,configurable:true});Bounded.prototype.cloneImplementation=function(){return new Bounded(this.firstChild,this.min,this.max)};return Bounded}(Rule);Myna_1.Bounded=Bounded;var Advance=function(_super){__extends(Advance,_super);function Advance(){_super.call(this,[]);this.type="advance"}Advance.prototype.parseImplementation=function(index){return index<_input.length?index+1:failed};Object.defineProperty(Advance.prototype,"definition",{get:function(){return"."},enumerable:true,configurable:true});Advance.prototype.cloneImplementation=function(){return new Advance};return Advance}(Rule);Myna_1.Advance=Advance;var Lookup=function(_super){__extends(Lookup,_super);function Lookup(lookup,onDefault){_super.call(this,[]);this.lookup=lookup;this.onDefault=onDefault;this.type="lookup"}Lookup.prototype.parseImplementation=function(index){if(index>=_input.length)return failed;var tkn=_input[index];var r=this.lookup[tkn];if(r!==undefined)return r.parse(index);return this.onDefault.parse(index)};Object.defineProperty(Lookup.prototype,"definition",{get:function(){var _this=this;return"{"+Object.keys(this.lookup).map(function(k){return'"'+escapeChars(k)+'" :'+_this.lookup[k].toString()}).join(",")+"}"},enumerable:true,configurable:true});Lookup.prototype.cloneImplementation=function(){return new Lookup(this.lookup,this.onDefault)};return Lookup}(Rule);Myna_1.Lookup=Lookup;function tokensToDictionary(tokens,rule){var d={};for(var _i=0,tokens_1=tokens;_i<tokens_1.length;_i++){var t=tokens_1[_i];if(t in d)throw Exceptions.TokenIncludedTwiceInLookup;d[t]=RuleTypeToRule(rule)}return d}Myna_1.tokensToDictionary=tokensToDictionary;var CharSet=function(_super){__extends(CharSet,_super);function CharSet(chars){_super.call(this,tokensToDictionary(chars.split(""),Myna_1.advance),Myna_1.falsePredicate);this.chars=chars;this.type="charSet"}Object.defineProperty(CharSet.prototype,"definition",{get:function(){return"["+escapeChars(this.chars)+"]"},enumerable:true,configurable:true});CharSet.prototype.cloneImplementation=function(){return new CharSet(this.chars)};return CharSet}(Lookup);Myna_1.CharSet=CharSet;var NegatedCharSet=function(_super){__extends(NegatedCharSet,_super);function NegatedCharSet(chars){_super.call(this,tokensToDictionary(chars.split(""),Myna_1.falsePredicate),Myna_1.truePredicate);this.chars=chars;this.type="negatedCharSet"}Object.defineProperty(NegatedCharSet.prototype,"definition",{get:function(){return"[^"+escapeChars(this.chars)+"]"},enumerable:true,configurable:true});NegatedCharSet.prototype.cloneImplementation=function(){return new NegatedCharSet(this.chars)};return NegatedCharSet}(Lookup);Myna_1.NegatedCharSet=NegatedCharSet;function rangeToDictionary(min,max,rule){if(min.length!=1||max.length!=1)throw Exceptions.RangeRequiresChars;var minChar=min.charCodeAt(0);var maxChar=max.charCodeAt(0);var d={};for(var x=minChar;x<=maxChar;++x)d[String.fromCharCode(x)]=rule;return d}Myna_1.rangeToDictionary=rangeToDictionary;var CharRange=function(_super){__extends(CharRange,_super);function CharRange(min,max){_super.call(this,rangeToDictionary(min,max,Myna_1.advance),Myna_1.falsePredicate);this.min=min;this.max=max;this.type="charRange"}Object.defineProperty(CharRange.prototype,"definition",{get:function(){return"["+this.min+".."+this.max+"]"},enumerable:true,configurable:true});CharRange.prototype.cloneImplementation=function(){return new CharRange(this.min,this.max)};return CharRange}(Lookup);Myna_1.CharRange=CharRange;var Text=function(_super){__extends(Text,_super);function Text(text){_super.call(this,[]);this.text=text;this.type="text"}Text.prototype.parseImplementation=function(index){if(index>_input.length-this.text.length)return failed;for(var i=0;i<this.text.length;++i)if(_input[index+i]!==this.text[i])return failed;return index+this.text.length};Object.defineProperty(Text.prototype,"definition",{get:function(){return'"'+escapeChars(this.text)+'"'},enumerable:true,configurable:true});Text.prototype.cloneImplementation=function(){return new Text(this.text)};return Text}(Rule);Myna_1.Text=Text;var Delay=function(_super){__extends(Delay,_super);function Delay(fn){_super.call(this,[]);this.fn=fn;this.type="delay"}Delay.prototype.parseImplementation=function(index){return this.fn().parse(index)};Delay.prototype.cloneImplementation=function(){return new Delay(this.fn)};Object.defineProperty(Delay.prototype,"definition",{get:function(){return"delay("+this.fn()+")"},enumerable:true,configurable:true});return Delay}(Rule);Myna_1.Delay=Delay;var PredicateRule=function(_super){__extends(PredicateRule,_super);function PredicateRule(){_super.apply(this,arguments)}PredicateRule.prototype.parse=function(index){var result=failed;var state=_childNodes.length;if(this.match(index))result=index;_childNodes.length=state;return result};return PredicateRule}(Rule);Myna_1.PredicateRule=PredicateRule;var Not=function(_super){__extends(Not,_super);function Not(rule){_super.call(this,[rule]);this.type="not"}Not.prototype.match=function(index){return!this.firstChild.match(index)};Not.prototype.cloneImplementation=function(){return new Not(this.firstChild)};Object.defineProperty(Not.prototype,"definition",{get:function(){return"!"+this.firstChild.toString()},enumerable:true,configurable:true});return Not}(PredicateRule);Myna_1.Not=Not;var At=function(_super){__extends(At,_super);function At(rule){_super.call(this,[rule]);this.type="at"}At.prototype.match=function(index){return this.firstChild.match(index)};At.prototype.cloneImplementation=function(){return new At(this.firstChild)};Object.defineProperty(At.prototype,"definition",{get:function(){return"&"+this.firstChild.toString()},enumerable:true,configurable:true});return At}(PredicateRule);Myna_1.At=At;var Predicate=function(_super){__extends(Predicate,_super);function Predicate(fn){_super.call(this,[]);this.fn=fn;this.type="predicate"}Predicate.prototype.match=function(index){return this.fn(index)};Predicate.prototype.cloneImplementation=function(){return new Predicate(this.fn)};Object.defineProperty(Predicate.prototype,"definition",{get:function(){return"predicate("+this.fn+")"},enumerable:true,configurable:true});return Predicate}(PredicateRule);Myna_1.Predicate=Predicate;function text(text){return new Text(text)}Myna_1.text=text;function seq(){var rules=[];for(var _i=0;_i<arguments.length;_i++){rules[_i-0]=arguments[_i]}return new Sequence(rules.map(RuleTypeToRule))}Myna_1.seq=seq;function choice(){var rules=[];for(var _i=0;_i<arguments.length;_i++){rules[_i-0]=arguments[_i]}return new Choice(rules.map(RuleTypeToRule))}Myna_1.choice=choice;function delay(fxn){return new Delay(function(){return RuleTypeToRule(fxn())})}Myna_1.delay=delay;function not(rule){return new Not(RuleTypeToRule(rule))}Myna_1.not=not;function bounded(rule,min,max){if(min===void 0){min=0}if(max===void 0){max=Infinity}return new Bounded(RuleTypeToRule(rule),min,max)}Myna_1.bounded=bounded;function zeroOrMore(rule){return bounded(rule).setType("zeroOrMore")}Myna_1.zeroOrMore=zeroOrMore;function oneOrMore(rule){return bounded(rule,1).setType("oneOrMore")}Myna_1.oneOrMore=oneOrMore;function opt(rule){return bounded(rule,0,1).setType("opt")}Myna_1.opt=opt;function repeat(rule,count){return bounded(rule,count,count).setType("repeat")}Myna_1.repeat=repeat;function at(rule){return new At(RuleTypeToRule(rule))}Myna_1.at=at;function lookup(tokens,rule,onDefault){if(onDefault===void 0){onDefault=false}return new Lookup(tokensToDictionary(tokens,rule),RuleTypeToRule(onDefault))}Myna_1.lookup=lookup;function atChar(chars){return at(char(chars))}Myna_1.atChar=atChar;function notAtChar(chars){return not(char(chars))}Myna_1.notAtChar=notAtChar;function charExcept(chars){return notAtChar(chars).advance}Myna_1.charExcept=charExcept;function char(chars){return new CharSet(chars)}Myna_1.char=char;function range(min,max){return new CharRange(min,max)}Myna_1.range=range;function exceptRange(min,max){return range(min,max).not.then(Myna_1.advance)}Myna_1.exceptRange=exceptRange;function delimited(rule,delimiter){return opt(seq(rule,zeroOrMore(seq(delimiter,rule)))).setType("delimitedList")}Myna_1.delimited=delimited;function except(condition,rule){return seq(not(condition),rule).setType("except")}Myna_1.except=except;function repeatWhileNot(body,condition){return zeroOrMore(except(condition,body)).setType("whileNot")}Myna_1.repeatWhileNot=repeatWhileNot;function repeatUntilPast(body,condition){return seq(repeatWhileNot(body,condition),condition).setType("repeatUntilPast")}Myna_1.repeatUntilPast=repeatUntilPast;function advanceWhileNot(rule){return not(rule).advance.zeroOrMore.setType("advanceWhileNot")}Myna_1.advanceWhileNot=advanceWhileNot;function advanceUntilPast(rule){return seq(advanceWhileNot(rule),rule).setType("advanceUntilPast")}Myna_1.advanceUntilPast=advanceUntilPast;function advanceUnless(rule){return Myna_1.advance.butNot(rule).setType("advanceUnless")}Myna_1.advanceUnless=advanceUnless;function predicate(fn){return new Predicate(fn)}Myna_1.predicate=predicate;function action(fn){return predicate(function(index){fn(index);return true}).setType("action")}Myna_1.action=action;function err(ex){return action(function(p){ex.location=p;throw ex}).setType("err")}Myna_1.err=err;function log(msg){if(msg===void 0){msg=""}return action(function(p){console.log(msg)}).setType("log")}Myna_1.log=log;function assert(rule){return choice(rule,err({rule:rule,type:"assert"})).setType("assert")}Myna_1.assert=assert;function guardedSeq(condition){var rules=[];for(var _i=1;_i<arguments.length;_i++){rules[_i-1]=arguments[_i]}return seq(condition,seq.apply(void 0,rules.map(function(r){return assert(r)}))).setType("guardedSeq")}Myna_1.guardedSeq=guardedSeq;function doubleQuoted(rule){return guardedSeq('"',rule,'"').setType("doubleQuoted")}Myna_1.doubleQuoted=doubleQuoted;function singleQuoted(rule){return guardedSeq("'",rule,"'").setType("singleQuoted")}Myna_1.singleQuoted=singleQuoted;function join(sep){var xs=[];for(var _i=1;_i<arguments.length;_i++){xs[_i-1]=arguments[_i]}var r=[];for(var i=0;i<xs.length;++i){if(i>0)r.push(sep);r.push(xs[i])}return r}Myna_1.join=join;function keywordMap(){var rules=[];for(var _i=0;_i<arguments.length;_i++){rules[_i-0]=arguments[_i]}return rules.map(function(r){return typeof r=="string"?keyword(r):r})}Myna_1.keywordMap=keywordMap;function seqWs(){var rules=[];for(var _i=0;_i<arguments.length;_i++){rules[_i-0]=arguments[_i]}return seq.apply(void 0,join.apply(void 0,[Myna_1.ws].concat(rules)))}Myna_1.seqWs=seqWs;function parenthesized(rule){return guardedSeq("(",Myna_1.ws,rule,Myna_1.ws,")").setType("parenthesized")}Myna_1.parenthesized=parenthesized;function braced(rule){return guardedSeq("{",Myna_1.ws,rule,Myna_1.ws,"}").setType("braced")}Myna_1.braced=braced;function bracketed(rule){return guardedSeq("[",Myna_1.ws,rule,Myna_1.ws,"]").setType("bracketed")}Myna_1.bracketed=bracketed;function tagged(rule){return guardedSeq("<",Myna_1.ws,rule,Myna_1.ws,">").setType("tagged")}Myna_1.tagged=tagged;function keyword(text){return seq(text,not(Myna_1.identifierNext)).setType("keyword")}Myna_1.keyword=keyword;function keywords(){var words=[];for(var _i=0;_i<arguments.length;_i++){words[_i-0]=arguments[_i]}return choice.apply(void 0,words.map(keyword))}Myna_1.keywords=keywords;Myna_1.truePredicate=predicate(function(index){return true});Myna_1.falsePredicate=predicate(function(index){return false});Myna_1.end=predicate(function(index){return index>=_input.length});Myna_1.notEnd=predicate(function(index){return index<_input.length});Myna_1.advance=new Advance;Myna_1.all=Myna_1.advance.zeroOrMore;Myna_1.letterLower=range("a","z");Myna_1.letterUpper=range("A","Z");Myna_1.letter=choice(Myna_1.letterLower,Myna_1.letterUpper);Myna_1.letters=Myna_1.letter.oneOrMore;Myna_1.digit=range("0","9");Myna_1.digits=Myna_1.digit.oneOrMore;Myna_1.digitNonZero=range("1","9");Myna_1.integer=choice("0",seq(Myna_1.digitNonZero,Myna_1.digit.zeroOrMore));Myna_1.hexDigit=choice(Myna_1.digit,range("a","f"),range("A","F"));Myna_1.binaryDigit=char("01");Myna_1.octalDigit=range("0","7");Myna_1.alphaNumeric=choice(Myna_1.letter,Myna_1.digit);Myna_1.underscore=text("_");Myna_1.identifierFirst=choice(Myna_1.letter,Myna_1.underscore);Myna_1.identifierNext=choice(Myna_1.alphaNumeric,Myna_1.underscore);Myna_1.identifier=seq(Myna_1.identifierFirst,Myna_1.identifierNext.zeroOrMore);Myna_1.hyphen=text("-");Myna_1.crlf=text("\r\n");Myna_1.newLine=choice(Myna_1.crlf,"\n");Myna_1.space=text(" ");Myna_1.tab=text("\t");Myna_1.ws=char(" \t\r\n \ufeff").zeroOrMore;Myna_1.wordChar=Myna_1.letter.or(char("-'"));Myna_1.word=Myna_1.letter.then(Myna_1.wordChar.zeroOrMore);function grammarAstRules(grammarName){return grammarRules(grammarName).filter(function(r){return r._createAstNode})}Myna_1.grammarAstRules=grammarAstRules;function grammarRules(grammarName){return allGrammarRules().filter(function(r){return r.grammarName==grammarName})}Myna_1.grammarRules=grammarRules;function allGrammarRules(){return Object.keys(Myna_1.allRules).sort().map(function(k){return Myna_1.allRules[k]})}Myna_1.allGrammarRules=allGrammarRules;function grammarNames(){return Object.keys(Myna_1.grammars).sort()}Myna_1.grammarNames=grammarNames;function grammarToString(grammarName){return grammarRules(grammarName).map(function(r){return r.fullName+" <- "+r.definition}).join("\n")}Myna_1.grammarToString=grammarToString;function astSchemaToString(grammarName){return grammarAstRules(grammarName).map(function(r){return r.name+" <- "+r.astRuleDefn}).join("\n")}Myna_1.astSchemaToString=astSchemaToString;function registerGrammar(grammarName,grammarCtor){var grammar=new grammarCtor(this);initializeGrammar(grammarName,grammar)}Myna_1.registerGrammar=registerGrammar;function initializeGrammar(grammarName,grammar){for(var k in grammar){if(grammar[k]instanceof Rule){var rule=grammar[k];rule.setName(grammarName,k);Myna_1.allRules[rule.fullName]=rule}}Myna_1.grammars[grammarName]=grammar}Myna_1.initializeGrammar=initializeGrammar;function escapeChars(text){var r=JSON.stringify(text);return r.slice(1,r.length-1)}Myna_1.escapeChars=escapeChars;initializeGrammar("core",Myna)})(Myna||(Myna={}));if(typeof module==="object"&&module.exports)module.exports=Myna;